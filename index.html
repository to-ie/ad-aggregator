<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AdGregator: Adverts in Ireland, in one place</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: {} }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root { color-scheme: light; }
    .font-inter { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
  </style>
</head>

<body class="h-full font-inter bg-white text-slate-900 antialiased dark:bg-[#0b1220] dark:text-slate-100">

  <!-- Header -->
  <header class="sticky top-0 z-30 bg-white/80 backdrop-blur dark:bg-[#0b1220]/75">
    <div class="mx-auto flex max-w-3xl items-center justify-between px-4 py-4">
      <a href="https://ads.t-o.ie/" class="flex items-center gap-3">
        <img src="logo.png" alt="Adgregator" class="h-[60px] w-auto" />
        <span class="sr-only">Adgregator</span>
      </a>

      <div class="flex items-center gap-2">
        <!-- Theme toggle -->
        <button
          id="themeToggle"
          type="button"
          aria-label="Toggle dark mode"
          class="inline-flex h-9 w-9 items-center justify-center rounded-full text-slate-700 hover:bg-slate-100 active:scale-[0.98] dark:text-slate-200 dark:hover:bg-white/10"
          title="Toggle theme"
        >
          <!-- Sun (visible in dark mode) -->
          <svg xmlns="http://www.w3.org/2000/svg" class="hidden h-5 w-5 dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="4" />
            <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" />
          </svg>
          <!-- Moon (visible in light mode) -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z" />
          </svg>
        </button>

        <!-- About -->
        <button
          id="aboutBtn"
          type="button"
          aria-label="About AdGator"
          title="About"
          class="inline-flex h-9 w-9 items-center justify-center rounded-full text-slate-600 hover:bg-slate-100 active:scale-[0.98] dark:text-slate-200 dark:hover:bg-white/10"
        >
          <!-- Info icon -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="12" cy="12" r="9" />
            <path d="M9.5 9a2.5 2.5 0 1 1 4.2 1.8c-.9.6-1.7 1.2-1.7 2.2" />
            <circle cx="12" cy="17" r="0.8" fill="currentColor" />
          </svg>

        </button>

      </div>
    </div>

    <!-- Hairline divider -->
    <div class="border-b border-slate-200/60 dark:border-white/10"></div>
  </header>

  <main class="mx-auto max-w-3xl px-4 pb-20 pt-8">

    <!-- Minimal heading -->
    <!-- <div class="mb-6">
      <h1 class="text-lg font-semibold tracking-tight">Latest adverts</h1>
      <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">
        Filter by title and location. Opens in a new tab.
      </p>
    </div> -->

    <!-- Minimal search row -->
    <section class="mb-6">
      <div class="flex flex-col gap-3 sm:flex-row">
        <div class="relative flex-1">
          <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-slate-400">⌕</span>
          <input
            type="text"
            id="titleFilter"
            placeholder="e.g. bike, iPhone, sofa…"
            oninput="debouncedFilterAds()"
            class="w-full rounded-2xl border border-slate-200 bg-white py-2.5 pl-9 pr-3 text-sm outline-none placeholder:text-slate-400 focus:border-slate-300 focus:ring-4 focus:ring-slate-100 dark:border-white/10 dark:bg-white/5 dark:placeholder:text-slate-400 dark:focus:border-white/20 dark:focus:ring-white/10"
          />
        </div>

        <div class="relative flex-1">
          <span class="pointer-events-none absolute inset-y-0 left-3 flex items-center text-slate-400">⌕</span>
          <input
            type="text"
            id="locationFilter"
            placeholder="e.g. Dublin, Cork, Galway…"
            oninput="debouncedFilterAds()"
            class="w-full rounded-2xl border border-slate-200 bg-white py-2.5 pl-9 pr-3 text-sm outline-none placeholder:text-slate-400 focus:border-slate-300 focus:ring-4 focus:ring-slate-100 dark:border-white/10 dark:bg-white/5 dark:placeholder:text-slate-400 dark:focus:border-white/20 dark:focus:ring-white/10"
          />
        </div>

        <button
          id="clearBtn"
          type="button"
          onclick="clearFilters()"
          class="hidden rounded-2xl border border-slate-200 px-4 py-2.5 text-sm font-medium text-slate-700 hover:bg-slate-50 active:scale-[0.99] dark:border-slate-800 dark:text-slate-200 dark:hover:bg-slate-900"
        >
          Clear
        </button>
      </div>

      <div class="mt-3 text-xs text-slate-500 dark:text-slate-400">
        <span id="statusText">Type to search.</span>
      </div>
    </section>

    <!-- Results -->
    <section>
      <div id="loading" class="hidden text-sm text-slate-600 dark:text-slate-300">
        Loading adverts…
      </div>

      <div id="no-results" class="hidden text-sm text-slate-600 dark:text-slate-300">
        No matching results.
      </div>

      <ul id="adverts-list" class="hidden divide-y divide-slate-200/70 dark:divide-white/10"></ul>
    </section>

    <!-- About modal (minimal) -->
<div id="aboutModal" class="fixed inset-0 z-50 hidden">
  <div class="absolute inset-0 bg-black/50 backdrop-blur-md"></div>

  <div class="relative mx-auto mt-24 w-[92%] max-w-md rounded-3xl bg-white p-6 shadow-xl dark:bg-[#0f172a] dark:ring-1 dark:ring-white/10">
    <!-- Close -->
    <button
      id="aboutClose"
      type="button"
      class="absolute right-3 top-3 rounded-full p-2 text-slate-500 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-white/10"
      aria-label="Close"
    >
      ✕
    </button>

    <!-- Content -->
    <div class="pr-6">
      <h2 class="text-sm font-semibold">AdGregator</h2>

      <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
        Find the best deals in Ireland, all in one place! Right now, we feature ads from Adverts.ie (updated once a week), with DoneDeal.ie, eBay.ie, and Facebook Marketplace coming soon. Simple!<br>
      </p>

      <p class="mt-4 text-xs text-slate-500 dark:text-slate-400">
        Heads up! Images might take a moment to load. If you don't see any ads after entering your search, check that uBlock Origin or other ad blockers aren't getting in the way.<br><br>
        Last updated: 2026-01-28T14:33
      </p>
    </div>
  </div>
</div>


  </main>

  <script>
    let advertsData = [];
    let debounceTimer;

    const elList = document.getElementById("adverts-list");
    const elNoResults = document.getElementById("no-results");
    const elLoading = document.getElementById("loading");
    const elStatus = document.getElementById("statusText");
    const elClear = document.getElementById("clearBtn");

    function setHidden(el, hidden) {
      if (hidden) el.classList.add("hidden");
      else el.classList.remove("hidden");
    }

    function hasFilters() {
      const title = document.getElementById("titleFilter").value.trim();
      const loc = document.getElementById("locationFilter").value.trim();
      return title.length > 0 || loc.length > 0;
    }

    function updateStatus(text) {
      elStatus.textContent = text;
      setHidden(elClear, !hasFilters());
    }

    async function loadAdverts() {
      setHidden(elLoading, false);
      updateStatus("Loading…");

      const cachedData = localStorage.getItem("advertsData");
      if (cachedData) {
        advertsData = JSON.parse(cachedData);
        setHidden(elLoading, true);
        updateStatus("Type to search.");
        return;
      }

      try {
        const response = await fetch("results/adverts.json", { cache: "no-cache" });
        advertsData = await response.json();
        localStorage.setItem("advertsData", JSON.stringify(advertsData));
      } catch (error) {
        console.error("Error loading adverts:", error);
        updateStatus("Couldn’t load adverts. Check the console.");
      } finally {
        setHidden(elLoading, true);
      }
    }

    function displayAdverts(adverts) {
      elList.innerHTML = "";

      if (adverts.length === 0) {
        setHidden(elList, true);
        setHidden(elNoResults, false);
        updateStatus("0 results");
        return;
      }

      setHidden(elNoResults, true);
      setHidden(elList, false);
      updateStatus(`${adverts.length} result${adverts.length === 1 ? "" : "s"}`);

      const fragment = document.createDocumentFragment();

      adverts.forEach(ad => {
        const li = document.createElement("li");
        li.className = "group cursor-pointer py-3";
        li.onclick = (event) => {
          if (!event.target.classList.contains("view-button")) {
            window.open(ad.link, "_blank");
          }
        };

        const safeTitle = (ad.title || "").replaceAll('"', "&quot;");

        li.innerHTML = `
          <div class="flex items-center gap-3">
            <img
              src="${ad.image}"
              alt="${safeTitle}"
              class="h-12 w-12 rounded-2xl object-cover ring-1 ring-slate-200/70 dark:ring-white/10"
              loading="lazy"
            />

            <div class="min-w-0 flex-1">
              <div class="truncate text-sm font-medium text-slate-900 dark:text-slate-50">${ad.title}</div>
              <div class="mt-0.5 flex flex-wrap items-center gap-x-2 gap-y-1 text-xs text-slate-500 dark:text-slate-400">
                <span class="font-semibold text-emerald-700 dark:text-emerald-300">${ad.price}</span>
                <span class="text-slate-300 dark:text-slate-700">•</span>
                <span>${ad.location}</span>
              </div>
            </div>

            <button
              class="view-button rounded-2xl px-3 py-2 text-xs font-medium text-slate-700 hover:bg-slate-100 active:scale-[0.99] dark:text-slate-200 dark:hover:bg-white/10"
              onclick="window.open('${ad.link}', '_blank'); event.stopPropagation();"
              type="button"
            >
              View
            </button>
          </div>
        `;
        fragment.appendChild(li);
      });

      elList.appendChild(fragment);
    }

    function filterAds() {
      const titleFilter = document.getElementById("titleFilter").value.toLowerCase().trim();
      const locationFilter = document.getElementById("locationFilter").value.toLowerCase().trim();

      if (titleFilter === "" && locationFilter === "") {
        setHidden(elList, true);
        setHidden(elNoResults, true);
        updateStatus("Type to search.");
        return;
      }

      const filteredAds = advertsData.filter(ad =>
        (ad.title || "").toLowerCase().includes(titleFilter) &&
        (ad.location || "").toLowerCase().includes(locationFilter)
      );

      displayAdverts(filteredAds);
    }

    function debouncedFilterAds() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(filterAds, 160);
    }

    function clearFilters() {
      document.getElementById("titleFilter").value = "";
      document.getElementById("locationFilter").value = "";
      setHidden(elList, true);
      setHidden(elNoResults, true);
      updateStatus("Type to search.");
      document.getElementById("titleFilter").focus();
    }

    // Theme (persists)
    const themeKey = "adgatorTheme";
    function applyTheme(mode) {
      const root = document.documentElement;
      const isDark = mode === "dark";
      root.classList.toggle("dark", isDark);
      document.querySelector(":root").style.colorScheme = isDark ? "dark" : "light";
    }
    function initTheme() {
      const saved = localStorage.getItem(themeKey);
      if (saved === "dark" || saved === "light") return applyTheme(saved);
      const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      applyTheme(prefersDark ? "dark" : "light");
    }
    document.getElementById("themeToggle").addEventListener("click", () => {
      const isDark = document.documentElement.classList.contains("dark");
      const next = isDark ? "light" : "dark";
      localStorage.setItem(themeKey, next);
      applyTheme(next);
    });

    // About modal
    const aboutBtn = document.getElementById("aboutBtn");
    const aboutModal = document.getElementById("aboutModal");
    const aboutClose = document.getElementById("aboutClose");

    function openAbout() { setHidden(aboutModal, false); }
    function closeAbout() { setHidden(aboutModal, true); }

    aboutBtn.addEventListener("click", openAbout);
    aboutClose.addEventListener("click", closeAbout);
    aboutModal.addEventListener("click", (e) => { if (e.target === aboutModal) closeAbout(); });
    document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeAbout(); });

    window.onload = async () => {
      initTheme();
      await loadAdverts();
    };
  </script>
</body>
</html>
